!function(t){var e={init:function(o){return this.each(function(){var a=this,r=t(a).empty();a.opt=t.extend(!0,{},t.fn.raty.defaults,o),r.data("settings",a.opt),a.opt.number="function"==typeof a.opt.number?a.opt.number.call(a):e.between(a.opt.number,0,20),"/"!=a.opt.path.substring(a.opt.path.length-1,a.opt.path.length)&&(a.opt.path+="/"),"function"==typeof a.opt.score&&(a.opt.score=a.opt.score.call(a)),a.opt.score&&(a.opt.score=e.between(a.opt.score,0,a.opt.number));for(var n=1;n<=a.opt.number;n++)t("<img />",{src:a.opt.path+(!a.opt.score||a.opt.score<n?a.opt.starOff:a.opt.starOn),alt:n,title:n<=a.opt.hints.length&&null!==a.opt.hints[n-1]?a.opt.hints[n-1]:n}).appendTo(a),a.opt.space&&r.append(n<a.opt.number?"&#160;":"");a.stars=r.children('img:not(".raty-cancel")'),a.score=t("<input />",{type:"hidden",name:a.opt.scoreName}).appendTo(a),a.opt.score&&a.opt.score>0&&(a.score.val(a.opt.score),e.roundStar.call(a,a.opt.score)),a.opt.iconRange&&e.fill.call(a,a.opt.score),e.setTarget.call(a,a.opt.score,a.opt.targetKeep);var i=a.opt.space?4:0,s=a.opt.width||a.opt.number*a.opt.size+a.opt.number*i;a.opt.cancel&&(a.cancel=t("<img />",{src:a.opt.path+a.opt.cancelOff,alt:"x",title:a.opt.cancelHint,"class":"raty-cancel"}),"left"==a.opt.cancelPlace?r.prepend("&#160;").prepend(a.cancel):r.append("&#160;").append(a.cancel),s+=a.opt.size+i),a.opt.readOnly?(e.fixHint.call(a),a.cancel&&a.cancel.hide()):(r.css("cursor","pointer"),e.bindAction.call(a)),r.css("width",s)})},between:function(t,e,o){return Math.min(Math.max(parseFloat(t),e),o)},bindAction:function(){var o=this,a=t(o);a.mouseleave(function(){var t=o.score.val()||void 0;e.initialize.call(o,t),e.setTarget.call(o,t,o.opt.targetKeep),o.opt.mouseover&&o.opt.mouseover.call(o,t)});var r=o.opt.half?"mousemove":"mouseover";o.opt.cancel&&o.cancel.mouseenter(function(){t(this).attr("src",o.opt.path+o.opt.cancelOn),o.stars.attr("src",o.opt.path+o.opt.starOff),e.setTarget.call(o,null,!0),o.opt.mouseover&&o.opt.mouseover.call(o,null)}).mouseleave(function(){t(this).attr("src",o.opt.path+o.opt.cancelOff),o.opt.mouseover&&o.opt.mouseover.call(o,o.score.val()||null)}).click(function(t){o.score.removeAttr("value"),o.opt.click&&o.opt.click.call(o,null,t)}),o.stars.bind(r,function(r){var n=parseInt(this.alt,10);if(o.opt.half){var i=parseFloat((r.pageX-t(this).offset().left)/o.opt.size),s=i>.5?1:.5;n=parseFloat(this.alt)-1+s,e.fill.call(o,n),o.opt.precision&&(n=n-s+i),e.showHalf.call(o,n)}else e.fill.call(o,n);a.data("score",n),e.setTarget.call(o,n,!0),o.opt.mouseover&&o.opt.mouseover.call(o,n,r)}).click(function(t){o.score.val(o.opt.half||o.opt.precision?a.data("score"):this.alt),o.opt.click&&o.opt.click.call(o,o.score.val(),t)})},cancel:function(o){return t(this).each(function(){var a=this,r=t(a);return r.data("readonly")===!0?this:(o?e.click.call(a,null):e.score.call(a,null),void a.score.removeAttr("value"))})},click:function(o){return t(this).each(function(){return t(this).data("readonly")===!0?this:(e.initialize.call(this,o),this.opt.click?this.opt.click.call(this,o):e.error.call(this,'you must add the "click: function(score, evt) { }" callback.'),void e.setTarget.call(this,o,!0))})},error:function(e){t(this).html(e),t.error(e)},fill:function(t){for(var e,o,a,r=this,n=r.stars.length,i=0,s=1;n>=s;s++)e=r.stars.eq(s-1),r.opt.iconRange&&r.opt.iconRange.length>i?(o=r.opt.iconRange[i],a=r.opt.single?s==t?o.on||r.opt.starOn:o.off||r.opt.starOff:t>=s?o.on||r.opt.starOn:o.off||r.opt.starOff,s<=o.range&&e.attr("src",r.opt.path+a),s==o.range&&i++):(a=r.opt.single?s==t?r.opt.starOn:r.opt.starOff:t>=s?r.opt.starOn:r.opt.starOff,e.attr("src",r.opt.path+a))},fixHint:function(){var e=t(this),o=parseInt(this.score.val(),10),a=this.opt.noRatedMsg;!isNaN(o)&&o>0&&(a=o<=this.opt.hints.length&&null!==this.opt.hints[o-1]?this.opt.hints[o-1]:o),e.data("readonly",!0).css("cursor","default").attr("title",a),this.score.attr("readonly","readonly"),this.stars.attr("title",a)},getScore:function(){var e,o=[];return t(this).each(function(){e=this.score.val(),o.push(e?parseFloat(e):void 0)}),o.length>1?o:o[0]},readOnly:function(o){return this.each(function(){var a=t(this);return a.data("readonly")===o?this:(this.cancel&&(o?this.cancel.hide():this.cancel.show()),o?(a.unbind(),a.children("img").unbind(),e.fixHint.call(this)):(e.bindAction.call(this),e.unfixHint.call(this)),void a.data("readonly",o))})},reload:function(){return e.set.call(this,{})},roundStar:function(t){var e=(t-Math.floor(t)).toFixed(2);if(e>this.opt.round.down){var o=this.opt.starOn;e<this.opt.round.up&&this.opt.halfShow?o=this.opt.starHalf:e<this.opt.round.full&&(o=this.opt.starOff),this.stars.eq(Math.ceil(t)-1).attr("src",this.opt.path+o)}},score:function(){return arguments.length?e.setScore.apply(this,arguments):e.getScore.call(this)},set:function(e){return this.each(function(){var o=t(this),a=o.data("settings"),r=o.clone().removeAttr("style").insertBefore(o);o.remove(),r.raty(t.extend(a,e))}),t(this.selector)},setScore:function(o){return t(this).each(function(){return t(this).data("readonly")===!0?this:(e.initialize.call(this,o),void e.setTarget.call(this,o,!0))})},setTarget:function(o,a){if(this.opt.target){var r=t(this.opt.target);0==r.length&&e.error.call(this,"target selector invalid or missing!");var n=o;n=a&&void 0!==n?"hint"==this.opt.targetType?null===n&&this.opt.cancel?this.opt.cancelHint:this.opt.hints[Math.ceil(n-1)]:this.opt.precision?parseFloat(n).toFixed(1):n:this.opt.targetText,this.opt.targetFormat.indexOf("{score}")<0&&e.error.call(this,'template "{score}" missing!'),null!==o&&(n=this.opt.targetFormat.toString().replace("{score}",n)),r.is(":input")?r.val(n):r.html(n)}},showHalf:function(t){var e=(t-Math.floor(t)).toFixed(1);e>0&&.6>e&&this.stars.eq(Math.ceil(t)-1).attr("src",this.opt.path+this.opt.starHalf)},initialize:function(t){t=t?e.between(t,0,this.opt.number):0,e.fill.call(this,t),t>0&&(this.opt.halfShow&&e.roundStar.call(this,t),this.score.val(t))},unfixHint:function(){for(var e=0;e<this.opt.number;e++)this.stars.eq(e).attr("title",e<this.opt.hints.length&&null!==this.opt.hints[e]?this.opt.hints[e]:e);t(this).data("readonly",!1).css("cursor","pointer").removeAttr("title"),this.score.attr("readonly","readonly")}};t.fn.raty=function(o){return e[o]?e[o].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof o&&o?void t.error("Method "+o+" does not exist!"):e.init.apply(this,arguments)},t.fn.raty.defaults={cancel:!1,cancelHint:"cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:void 0,half:!1,halfShow:!0,hints:["bad","poor","regular","good","gorgeous"],iconRange:void 0,mouseover:void 0,noRatedMsg:"not rated yet",number:5,path:"img/",precision:!1,round:{down:.25,full:.6,up:.76},readOnly:!1,score:void 0,scoreName:"score",single:!1,size:16,space:!0,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",target:void 0,targetFormat:"{score}",targetKeep:!1,targetText:"",targetType:"hint",width:void 0}}(jQuery);